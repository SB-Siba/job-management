{% extends 'shoppingsite/base.html' %}
{% load static %}
{% block title %}
Checkout Page
{% endblock title %}

{% block main-content %}
<div class="container mt-3">
    <div class="row d-flex justify-content-center">
        <div class="col-md-8 order-md-5">
            <h4 class="mb-3">Billing address</h4>
            <input type="hidden" id="product_id" name="product_id" value={{product_uid}} />
            <div class="row">
                {% for i in addresses %}
                <div class="col d-flex flex-row pb-3">
                    <div class="d-flex align-items-center pe-2">
                        <input class="form-check-input" type="radio" name="addressNoLabel" id="addressNoLabel"
                            value="{{i.id}}" aria-label="..." checked />
                    </div>
                    <div class="rounded border w-100 p-3">
                        <p class="card-text">
                            <li style="font-size: xx-small;">Landmark 1 : {{i.landmark1}}</li>
                            <li style="font-size: xx-small;">Landmark 2 : {{i.landmark2}}</li>
                            <li style="font-size: xx-small;">Country : {{i.country}}</li>
                            <li style="font-size: xx-small;">State : {{i.state}}</li>
                            <li style="font-size: xx-small;">City : {{i.city}}</li>
                            <li style="font-size: xx-small;">Zipcode : {{i.zipcode}}</li>
                        </p>
                    </div>
                </div>
                {% endfor %}
            </div>
            <hr class="mb-4">
            <div class="d-flex justify-content-center">
                <button class="btn btn-success btn-lg btn-block text-center" id="rzp-button1">Continue to
                    checkout&nbsp;&nbsp;<i class="fa fa-inr" aria-hidden="true"></i><span
                        class="fw-bold">&nbsp;{{total_price}} /-</span></button>
            </div>
        </div>
    </div>
</div>
{% endblock main-content %}

{% block scriptjs %}
<!-- <script src="https://checkout.razorpay.com/v1/checkout.js"></script> -->
<script>
    $(document).ready(function(){
        $('#rzp-button1').click(function(){
            // Get the selected addressNoLabel value
            var selectedAddress = $('input[name="addressNoLabel"]:checked').val();
            var productId = $('#product_id').val();
            // Create data object to send with the AJAX request
            var data = {
                address_id: selectedAddress,
                productId:productId
            };

            // Perform AJAX POST request
            $.ajax({
                url: 'http://127.0.0.1:8000/directbuy/',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function(response){
                    console.log(response);
                    window.location.href = 'http://127.0.0.1:8000/';
                },
                error: function(xhr, status, error){
                    console.log("error")
                    console.error(xhr.responseText);
                }
            });
        });
    });
</script>

{% endblock scriptjs %}

<!-- var options = {
    "key": "{{api_key}}", 
    "amount": "{{amount}}", 
    "currency": "INR",
    "name": "Audio Book",
    "description": "Payment Transaction",
    "image": "https://example.com/your_logo",
    "order_id": "{{rz_order_id}}", 
    "callback_url": "{% url 'shoppingsite:paymentsuccess' %}",
    "prefill": {
        "contact": "{{request.user.contact}}"
    },
    "notes": {
        "address": "Demo Address"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);
document.getElementById('rzp-button1').onclick = function (e) {
    rzp1.open();
    e.preventDefault();
} -->